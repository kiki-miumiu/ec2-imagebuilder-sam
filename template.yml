AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: >
  Sample SAM Template for

Parameters:
  Name:
    Description: Name of App
    Type: String
    Default: hello-world
  EnvironmentType:
    Description: Name of Environment Type. Example - prod, test
    Type: String
    Default: test
  Owner:
    Description: An owner's login or team
    Type: String
    AllowedPattern: ".+"
    Default: Platform
  ImageRecipeVersion:
    Type: String
    Default: "1.0.0"
  ParentImage:
    Type: 'AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>'
    Default: '/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2'
Resources:   # Add Resource here
  IAM:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: cloudformation/iam.yml
      Parameters:
        EnvironmentType: !Ref EnvironmentType
        Name: !Ref Name
        Owner: !Ref Owner
  ImageRecipeAllParameters:
    Type: 'AWS::ImageBuilder::ImageRecipe'
    Properties:
      Name: !Ref Name
      Version: !Ref ImageRecipeVersion
      ParentImage: !Ref ParentImage
      Description: 'description'
      Components:
        - ComponentArn: "arn:aws:imagebuilder:ap-southeast-2:aws:component/update-linux/x.x.x"
      BlockDeviceMappings:
        - DeviceName: "/dev/xvda"
          VirtualName: "/dev/xvda"
          Ebs:
            DeleteOnTermination: true
            Iops: 100
            VolumeType: "gp2"
            VolumeSize: 8
            # Encrypted: true
            # KmsKeyId: !Ref KmsKeyId
            # SnapshotId: "snapshot-id" # No Required
      Tags:
        EnvironmentType: !Ref EnvironmentType
